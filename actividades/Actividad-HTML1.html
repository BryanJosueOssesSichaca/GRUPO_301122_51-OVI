<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Actividad HTML 1</title>
	<link rel="stylesheet" href="CSS/estilos-actividad-html.css"/>
	<link rel="stylesheet" href="../CSS/fonts.css"/>
</head>
<body>
	<main>
		<header>
	        <div class="logo">
	            <a href="https://www.unad.edu.co/" target="blank" title="Universidad Nacional abierta y a distancia"><img src="../Imagenes/logoUNAD2015.png" alt="Logo de la pagina web"></a>
	        </div><div class="principal">
	            <h1><a href="../index.html" target="_blank"> O.V.I Diseño Web - Grupo 51</a></h1>
	        </div> 
    	</header>
    	<nav>
    		<ul>
    			<li><input type="button" id="runCodeButton" value="Prueba tus cambios!"></li>
    			<li><input type="button" id="saveFileButton" value="Guardar los cambios" style="display:none"></li>
    			<li><input type="file" id="fileLoaderButton" value="Cargar tu propio Archivo" accept="text/*" style="display:none"></li>
    			<li>
    				Ejemplos HTML5 <span class="icon-html-five"></span> :
    				<select id="ejemplos">
    					<option value="0" selected="selected" disabled="disabled">Seleccionar Etiqueta</option>
    					<option value="1" >Encabezados HTML</option>
    					<option value="2">Parrafos HTML</option>
    					<option value="3">formularios HTML</option>
    					<option value="4">Botones HTML</option>
    				</select>
    			</li>
    		</ul>
    	</nav>
		<section class="editor">
			<div id="html">
				<h2>Editor HTML:</h2>
<textarea id="HTML"><!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Actividad HTML5 - OVI diseño web - Grupo 51</title>
</head>
<body>
	<main>
		<h1>Bienvenido a la actividad de HTML5</h1>
		<p>Estimado estudiante sea bienvenido a la actividad de HTML5 del OVI de diseño web del grupo 51, este mensaje tiene la función de guiarlo en la utilización del editor</p>
		<ul>
			<li><strong>Prueba tus cambios!</strong> el boton prueba tus cambios le permite probar en linea y en tiempo real los cambios realizados sobre las areas de texto disponibles</li>
			<li><strong>Ejemplos HTML5</strong> la lista desplegable Ejemplos HTML5 le ofrece ejemplos sobre las distintas etiquetas que componen el lenguaje HTML como encabezados, parrafos, etiquetas de formularios etc...</li>
		</ul>
		<p>
			en el area de texto titulada <strong>Editor HTML</strong> puede escribir codigo HTML, mientras que en el area de texto titulada <strong>Editor CSS</strong> puede escribir codigo CSS. los cambios se mostrarán en el area inferior titulada <strong>Visualización</strong> una vez que de click en el boton <strong>Prueba tus cambios!</strong>
		</p>
	</main>
</body>
</html></textarea>
			</div>
			<div id="css">
				<h2>Editor CSS:</h2>
<textarea id="CSS">
*{
	padding: 0;
	margin: 0;
	box-sizing: border-box;
}

body{
	font-family: monospace, Arial;
}

ul, ol{
	list-style: none;
	text-align: justify;
	padding: 10px;
}

ul li{
	padding: 5px;
}

ul li:hover{
	color:#5900b3;
}

main{
	width: 800px;
	margin: auto;
	text-align:center;
	padding: 10px;
	border: 1px solid #000;
	box-shadow: 2px 2px 3px #ccc;
	margin-top: 50px;
	border-radius: 10px;
}

h1{
	color: #b30000;
}

p{
	text-align: justify;
	margin: 10px 0;
	color: #1f2e2e;
}

</textarea>
			</div>
		</section>
		<section class="resultados">
			<h2>Visualización</h2>	
			<iframe id="targetCode"></iframe>
		</section>
	</main>

<script>
	/** Editor en linea **/

	var botonCodigo = document.getElementById("runCodeButton");
	var botonGuardar = document.getElementById("saveFileButton");

	function runCode(){
		var content = document.getElementById("HTML").value;
		var contentStyles = document.getElementById("CSS").value;
		var iframe = document.getElementById("targetCode");

		var documento = (iframe.contentWindow || iframe.contentDocument);

		if(documento.document) 
			documento = documento.document;

		//console.log(iframe);
		//console.log(iframe.contentWindow);
		//console.log(iframe.contentDocument.document);

			documento.open();
			documento.write(content);
			documento.close();	
		
		var styles = document.createElement("style");
		styles.innerHTML = "\n" + contentStyles + "\n";
		documento.head.append(styles);
	}
	botonCodigo.addEventListener("click",runCode);
	runCode();

	function cargarEjemplo(){
		var html = document.getElementById("HTML");
		var css = document.getElementById("CSS");
		var documentHtml = ["<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>", "</title>\r\t</head>\n\t<body>","\n\t</body>\n</html>"];
		var saveText;
		var styles;

		switch(this.value){
			case "1":
				saveText = documentHtml[0]+"Ejemplo Encabezados"+documentHtml[1]+"\n\t\t<h1>Encabezado de primer nivel</h1>\n\t\t<h2>Encabezado de segundo nivel</h2>\n\t\t<h3>Encabezado de tercer nivel</h3>\n\t\t<h4>Encabezado de cuarto nivel</h4>\n\t\t<h5>Encabezado de quinto nivel</h5>\n\t\t<h6>Encabezado de sexto nivel</h6>" + documentHtml[2];

				styles = "h1{color:#990000}\n\nh2{color:#cc3300}\n\nh3{color:#cc9900}\n\nh4{color:#86b300}\n\nh5{color:#66ff33}\n\nh6{color:#000}";
				break;
			case "2":
				saveText = documentHtml[0] + "Ejemplo parrafos" + documentHtml[1] + "\n\t\t<p> los parrafos en HTML5 se realizan con la etiqueta &lt;p&gt;"
				styles = "p {color: #0080ff}"
				break;
			case "3":
				break;
		}

		html.innerHTML = saveText;
		html.value = saveText;

		css.innerHTML = styles;
		css.value = styles;

		runCode();
	}

	document.getElementById("ejemplos").addEventListener("change",cargarEjemplo);

	/** Guardar archivo HTML **/
	function saveFile(){

		var html = document.getElementById("HTML").value;
		var saveText;

		if(html.indexOf("<meta") > 1){
			var css = document.getElementById("CSS").value;
			var subcadena = html.split("<meta");
			saveText = subcadena[0];
			saveText = saveText + "\n\t<style>\n" +  css.trim() + "\n\t</style>\n <meta " + subcadena[1];
		}else{
			saveText = html;
		}

		var blob = new Blob([saveText],{type: "text/html"});
		var fileName = prompt("Ingresar Nombre del archivo (sin extensión .html)");
		console.log(fileName);
		if(fileName){
			var link = document.createElement("a");
			link.download = fileName;
			link.innerHTML = "Descargar archivo";

			if(window.URL != null){
				link.href = window.URL.createObjectURL(blob);
			}else{
				link.href = window.URL.createObjectURL(textBlob);
				link.onclick = destroy;
				link.style.display = "none";
				document.body.appendChild(link);
			}
			link.click();
		}

		
	}

	function destroy(e){
		document.body.removeChild(e.target);
	}

	saveFileButton.addEventListener("click",saveFile);
	console.log("Autor: Bryan Josue Osses Sichaca - OVI diseño web - Grupo 51");

	/** Subir propio archivo HTML **/
	document.getElementById("fileLoaderButton").onchange = function(e){
		
		var file = this.files[0];

		if(file.type == "text/html" || file.type == "text/plain"){

			var fileReader = new FileReader();

			fileReader.onload = function(e){
				var text = e.target.result;
				document.getElementById("HTML").value = text; 
			}
			fileReader.readAsText(file,"UTF-8");
		}else{
			alert("Solo se pueden subir archivos con extensión .html .htm o .txt");
		}	
	}


	

	//Permitir tabulación en textarea
	var textareas = document.getElementsByTagName('textarea');
	var count = textareas.length;

	for(var i=0;i<count;i++){

	    textareas[i].onkeydown = function(e){

	        if(e.keyCode==9 || e.which==9){
	            e.preventDefault();
	            var s = this.selectionStart;
	            this.value = this.value.substring(0,this.selectionStart) + "\t" + this.value.substring(this.selectionEnd);
	            this.selectionEnd = s+1; 

	        }
	    }
	}

</script>
</body>
</html>